# BTC Gamma Scalping 回测说明

## 一、策略概览

* **策略名称**：BTC Gamma Scalping
* **核心思路**：买入看涨（Call）和看跌（Put）期权组成中性仓位，通过标的（BTC）和永续合约（Perp）的对冲，定期调整 Delta，赚取波动率与时间价值差。

## 二、基础定义

* **ATM（At‑The‑Money）期权**：执行价最接近当前 BTC 市价的期权。
* **Delta**：标的价格变动 \$1 时，期权价格的理论变动值。Call Δ > 0，Put Δ < 0。
* **Perp（永续合约）**：类似现货的合约，Delta 恒等于头寸张数（方向 × 数量）。
* **IV（隐含波动率）**：市场对标的未来波动率的预期，用于 Black‑Scholes（BSM）定价。

## 三、参数获取

通过交易所 API 拉取：

* BTC 最新现货价格（Spot）
* ATM Call/Put 最新交易价格
* Call/Put 当前隐含波动率（IV）
* 永续合约最新价格

## 四、建仓逻辑

### 建仓时机选择

* 每月一号固定建仓

### 仓位规模

* 初始投入 1 张 call 和 1 张 put 成本的 BTC
* 100% 投入

### 标的选择

* 下个月最后一个周五到期的期权
* 执行价选最接近现价的 ATM 合约

### 目标 Delta

* 初始组合 Delta ≈ 0（Call Δ + Put Δ ≈ 0）
* 若实际偏离，用 Perp 进行对冲

## 五、对冲逻辑

### 触发与频率

* 每隔 2 天（可选 1、2、3 天）检查一次组合 Delta

### 偏离阈值

* 若组合 Δ 超出区间 `[-0.1 × N_put`，`+0.1 × N_call + 1 × N_perp]` 方向，其中 N\_put、N\_call、N\_perp 为 Put/Call/Perp 合约张数

### 对冲操作

* 买入/卖出相应方向的永续合约，使 Δ 回归至上述区间

## 六、平仓逻辑

### 时间节点

* 每月一号统一平仓

### 操作

* 卖出所有期权头寸及 Perp 对冲头寸
* 并使用所有资产再次建仓

## 七、费用与滑点

| 费用类别     | 收费标准                               |
| -------- | ---------------------------------- |
| 期权手续费    | 名义价值 0.025%，双腿合约同次操作只收一次           |
| Perp 手续费 | Taker 0.05%，Maker 0（本策略按 Taker 计算） |

## 八、关键计算公式

* **剩余到期时间**：`期权到期日 - 当天日期`
* **Delta 计算**：根据 BSM 公式，基于 spot price、期权最新价格、IV、剩余到期时间，分别计算期权的 delta，Perp 的 delta = 方向数量 × 1
* **组合 delta**：`call delta + put delta + perp delta`
* **仓位成本**：`call 成本 + put 成本 + perp 开仓价格 × 数量`
* **仓位价值**：`call 最新价格 + put 最新价格 + perp 价值`
* **未实现盈亏**：`仓位价值 - 仓位成本`
* **已实现盈亏**：`平仓现金流 - 对应仓位建仓现金流`
* **总资产**：`未使用现金部分 + 累计已实现盈亏 + 仓位价值`

## 九、回测输出表结构

| 字段      | 说明 |
| ------- | -- |
| 日期      |    |
| BTC 现价  |    |
| 到期日     |    |
| 剩余天数    |    |
| Call Δ  |    |
| Put Δ   |    |
| Perp Δ  |    |
| 组合 Δ    |    |
| 仓位成本    |    |
| 当前市值    |    |
| 未实现 P/L |    |
| 已实现 P/L |    |
| 总资产     |    |
| 净值增长率   |    |

